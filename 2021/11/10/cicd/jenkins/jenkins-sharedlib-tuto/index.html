<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>[Jenkins Job DSL]jenkins pipeline 编写共享库 - Unprofessional BUG</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Unprofessional BUG"><meta name="msapplication-TileImage" content="/gallery/common/ava.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Unprofessional BUG"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Jenkins Shared Libraries使用Jenkins pipeline时, 我们有时不希望代码过于混乱, 代码过于重复,比如一个公用方法, 公用类我们希望它是编写一次, 然后被共享, 但是在Job DSL Plugin 1.60, 以前, 我们可以通过注入共享的groovy文件来达到目的, 但是新版本由于安全问题 Script-Security, 这种注入的方法被关闭, 如若没有管理"><meta property="og:type" content="blog"><meta property="og:title" content="[Jenkins Job DSL]jenkins pipeline 编写共享库"><meta property="og:url" content="https://unprobug.com/2021/11/10/cicd/jenkins/jenkins-sharedlib-tuto/"><meta property="og:site_name" content="Unprofessional BUG"><meta property="og:description" content="Jenkins Shared Libraries使用Jenkins pipeline时, 我们有时不希望代码过于混乱, 代码过于重复,比如一个公用方法, 公用类我们希望它是编写一次, 然后被共享, 但是在Job DSL Plugin 1.60, 以前, 我们可以通过注入共享的groovy文件来达到目的, 但是新版本由于安全问题 Script-Security, 这种注入的方法被关闭, 如若没有管理"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.jenkins.io/zh/doc/book/resources/pipeline/configure-global-pipeline-library.png"><meta property="article:published_time" content="2021-11-10T07:47:09.000Z"><meta property="article:modified_time" content="2022-06-08T18:32:05.042Z"><meta property="article:author" content="Jiang WU"><meta property="article:tag" content="jenkins"><meta property="article:tag" content="intellij"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://www.jenkins.io/zh/doc/book/resources/pipeline/configure-global-pipeline-library.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://unprobug.com/2021/11/10/cicd/jenkins/jenkins-sharedlib-tuto/"},"headline":"[Jenkins Job DSL]jenkins pipeline 编写共享库","image":["https://www.jenkins.io/zh/doc/book/resources/pipeline/configure-global-pipeline-library.png"],"datePublished":"2021-11-10T07:47:09.000Z","dateModified":"2022-06-08T18:32:05.042Z","author":{"@type":"Person","name":"Jiang WU"},"publisher":{"@type":"Organization","name":"Unprofessional BUG","logo":{"@type":"ImageObject","url":"https://unprobug.com/gallery/common/ava.png"}},"description":"Jenkins Shared Libraries使用Jenkins pipeline时, 我们有时不希望代码过于混乱, 代码过于重复,比如一个公用方法, 公用类我们希望它是编写一次, 然后被共享, 但是在Job DSL Plugin 1.60, 以前, 我们可以通过注入共享的groovy文件来达到目的, 但是新版本由于安全问题 Script-Security, 这种注入的方法被关闭, 如若没有管理"}</script><link rel="canonical" href="https://unprobug.com/2021/11/10/cicd/jenkins/jenkins-sharedlib-tuto/"><link rel="alternate" href="/atom.xml" title="Unprofessional BUG" type="application/atom+xml"><link rel="icon" href="/gallery/common/ava.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/agate.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-QNSJ3VFPDD" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-QNSJ3VFPDD');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/gallery/common/ava.png" alt="Unprofessional BUG" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/copyright">Copyright</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-11-10T07:47:09.000Z" title="11/10/2021, 9:47:09 AM">2021-11-10</time>发表</span><span class="level-item"><time dateTime="2022-06-08T18:32:05.042Z" title="6/8/2022, 9:32:05 PM">2022-06-08</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/jenkins/">jenkins</a></span><span class="level-item">9 分钟读完 (大约1309个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">[Jenkins Job DSL]jenkins pipeline 编写共享库</h1><div class="content"><h2 id="Jenkins-Shared-Libraries"><a href="#Jenkins-Shared-Libraries" class="headerlink" title="Jenkins Shared Libraries"></a>Jenkins Shared Libraries</h2><p>使用Jenkins pipeline时, 我们有时不希望代码过于混乱, 代码过于重复,比如一个公用方法, 公用类我们希望它是编写一次, 然后被共享, 但是在Job DSL Plugin 1.60, 以前, 我们可以通过注入共享的groovy文件来达到目的, 但是新版本由于安全问题 <a target="_blank" rel="noopener" href="https://github.com/jenkinsci/job-dsl-plugin/wiki/Script-Security">Script-Security</a>, 这种注入的方法被关闭, 如若没有管理员权限开放, 这种方法是不可以使用了:</p>
<p><em>To avoid loading arbitrary code from the workspace without approval, the script directory is not added to the classpath and additional classpath entries are not supported when security is enabled. Thus importing classes from the workspace is not possible and the “Additional Classpath” option is not available.</em></p>
<h2 id="如何使用和扩展-Shared-Libraries"><a href="#如何使用和扩展-Shared-Libraries" class="headerlink" title="如何使用和扩展 Shared Libraries"></a>如何使用和扩展 Shared Libraries</h2><p>官网介绍的比较清楚: <a target="_blank" rel="noopener" href="https://www.jenkins.io/zh/doc/book/pipeline/shared-libraries/">传送门</a></p>
<p>接着上面官网的例子, 实际应用中需要注意的几个点:</p>
<span id="more"></span>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>这个结构中src 可以理解为java中的src, vars可以理解为你要写的pipeline step调用方法, 比如我们可以将一些公用的类, 方法放在src, 比如下图中Bar.groovy, 然后, 你计划写一个 sayHi() 的step中的方法, 那么可以在这里写一个sayHi.groovy, 这个sayHi.groovy 可以调用Bar.groovy这个类.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line">+- src                     <span class="comment"># Groovy source files</span></span><br><span class="line">|   +- org</span><br><span class="line">|       +- foo</span><br><span class="line">|           +- Bar.groovy  <span class="comment"># for org.foo.Bar class</span></span><br><span class="line">+- vars</span><br><span class="line">|   +- foo.groovy          <span class="comment"># for global &#x27;foo&#x27; variable</span></span><br><span class="line">|   +- foo.txt             <span class="comment"># help for &#x27;foo&#x27; variable</span></span><br><span class="line">|   +- sayHi.groovy </span><br><span class="line">+- resources               <span class="comment"># resource files (external libraries only)</span></span><br><span class="line">|   +- org</span><br><span class="line">|       +- foo</span><br><span class="line">|           +- bar.json   <span class="comment"># static helper data for org.foo.Bar</span></span><br></pre></td></tr></table></figure>

<h3 id="step-方法的写法"><a href="#step-方法的写法" class="headerlink" title="step 方法的写法"></a>step 方法的写法</h3><p>紧接着上面的例子, 那么Bar.groovy和sayHi.groovy分别怎么写</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Bar.groovy</span></span><br><span class="line"><span class="keyword">package</span> org.foo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">    String name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sayHi.groovy</span></span><br><span class="line"><span class="keyword">import</span> org.foo.Student</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> call(String name = <span class="string">&quot;foo&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">def</span> bar = <span class="keyword">new</span> Bar(<span class="string">&#x27;name&#x27;</span>: name)</span><br><span class="line">    echo <span class="string">&quot;Hello, $&#123;bar.name&#125;.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个地方最重要是注意, 包, 也就是”package” 和 “import”, 生产中, 有时会因为包产生类似 <em>cannot resolve symbol</em> 或者找不到包这些问题, 这也是你debug时候可能遇到的问题. 另外一个, 这个地方必须实现call()方法, 也就是脚本的入口</p>
<h3 id="使用自己的公共文件"><a href="#使用自己的公共文件" class="headerlink" title="使用自己的公共文件"></a>使用自己的公共文件</h3><p>我这里没有说 “使用自己的共享库”, 而是 “自己的公共文件”, 原因是, 你不用共享库同样可以达到共享的效果, 请往下看</p>
<h4 id="classpath-的配置"><a href="#classpath-的配置" class="headerlink" title="classpath 的配置"></a>classpath 的配置</h4><ul>
<li>Job DSL 1.60 插件版本前</li>
</ul>
<p>这个版本前可以参考 <a target="_blank" rel="noopener" href="https://github.com/sheehan/job-dsl-gradle-example">https://github.com/sheehan/job-dsl-gradle-example</a>, 这个例子包含是一个以gradle为管理工具的工程, 不是重点, 重点是需要和上面说的目录结构一致即可. 1.6 版本前, 我们可以使用Additional classpath, 比如, 这个工程中, 目录结构是:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── src</span><br><span class="line">│   ├── <span class="built_in">jobs</span>                <span class="comment"># DSL script files</span></span><br><span class="line">│   ├── main</span><br><span class="line">│   │   ├── groovy          <span class="comment"># support classes</span></span><br><span class="line">│   │   └── resources</span><br><span class="line">│   │       └── idea.gdsl   <span class="comment"># IDE support for IDEA</span></span><br><span class="line">│   ├── scripts             <span class="comment"># scripts to use with &quot;readFileFromWorkspace&quot;</span></span><br><span class="line">│   └── <span class="built_in">test</span></span><br><span class="line">│       └── groovy          <span class="comment"># specs</span></span><br><span class="line">└── build.gradle            <span class="comment"># build file</span></span><br></pre></td></tr></table></figure>
<p>然后在自己jenkins UI Job界面上, BUILD下process Job DSLs 项中配置Additional classpath: <strong>src&#x2F;main&#x2F;groovy</strong>. 也就是让你的pipeline 脚本能找到这个.class文件. 这个地方个人理解, 因为jenkins pipeline类加载的方式和java, groovy 不太一样, 它有自己的顺序, 所以也就有了之前包的问题的存在. 即便如此, 你还是需要注意包的问题, 也就是 “import” 和 “package”. 假设你的additional path配置不好, 很有可能碰到一些问题. 之前就因为同时配置时错误, 导致src是一个普通存在的包, 所以, 绕道(因为没权限)测试发现我们需要”package src”, 引入时就是”import src.Myclass”. 总之,这里也就是我之前提到的不用共享库同样可以达到共享的效果.</p>
<ul>
<li>Job DSL 1.60 插件版本后</li>
</ul>
<p>前面也说了, 1.6后, 你可以手动在全局配置 Configure Global Security, 中不勾选Enable script security for Job DSL scripts, 这样你就可以继续使用Additional classpath, 而不用上面的共享库. 但是不建议这么做, 显然如果有人恶意利用漏洞(CVE-2018-1000861), 那么老板和小姨子只能跑路了.</p>
<p>安全期间,还是在jenkins中配置自己的库, 具体参考官方文档, 一般快速配置就是在全局配置中配置 Global Pipeline Libraries, 配置自己的代码库即可<img src="https://www.jenkins.io/zh/doc/book/resources/pipeline/configure-global-pipeline-library.png">, 同时也可以根据需要, 使用灵活的配置方法.</p>
<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><p>你可以在你的dsl job 中build Triggers 下 Pipeline选项卡中, 选择Pipeline script选项卡下测试</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用共享库</span></span><br><span class="line"><span class="meta">@Library</span>(<span class="string">&#x27;pipeline-library-demo&#x27;</span>)_</span><br><span class="line"><span class="comment">// 你也可以直接引用共享库中的类</span></span><br><span class="line"><span class="comment">// import com.wj.GlobalVars</span></span><br><span class="line"></span><br><span class="line">stage(<span class="string">&#x27;Demo&#x27;</span>) &#123;</span><br><span class="line">    echo <span class="string">&#x27;Hello world&#x27;</span></span><br><span class="line">    <span class="comment">//调用 sayHi.groovy, sayHi中定义了call方法.</span></span><br><span class="line">    sayHi <span class="string">&#x27;test test test&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="开发框架"><a href="#开发框架" class="headerlink" title="开发框架"></a>开发框架</h2><p>这里有一个比较好的gradle管理, jenkins dsl 共享库插件, 但是年久失修, 不过能凑合用: <a target="_blank" rel="noopener" href="https://github.com/mkobit/jenkins-pipeline-shared-libraries-gradle-plugin#5-minute-onboarding">插件</a>, <a target="_blank" rel="noopener" href="https://github.com/mkobit/jenkins-pipeline-shared-library-example">例子</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://emilwypych.com/2018/04/15/jenkins-unable-resolve-class-utilities-myutilities/">https://emilwypych.com/2018/04/15/jenkins-unable-resolve-class-utilities-myutilities/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jenkinsci/job-dsl-plugin/wiki/Script-Security">https://github.com/jenkinsci/job-dsl-plugin/wiki/Script-Security</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/DynastyRumble/article/details/119208326#t9">Jenkins + Groovy脚本 &#x3D; 高效✔✔ （纯干货）</a></li>
<li>intellij</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>[Jenkins Job DSL]jenkins pipeline 编写共享库</p><p><a href="https://unprobug.com/2021/11/10/cicd/jenkins/jenkins-sharedlib-tuto/">https://unprobug.com/2021/11/10/cicd/jenkins/jenkins-sharedlib-tuto/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Jiang WU</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-11-10</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-06-08</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/jenkins/">jenkins</a><a class="link-muted mr-2" rel="tag" href="/tags/intellij/">intellij</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="https://afdian.net/@unprobug" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/gallery/common/alipay_qr.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/gallery/common/wechat_qr.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/02/03/linux/command/linux-command-how-to-check-container-opened-file-md/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">如何查看容器对应的宿主上打开的文件</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/10/26/idea/intellij/intellij-no-mouse-tips-1/"><span class="level-item">[intellij] intellj无鼠标常用操作</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread',
            appId: "AUgm1ujNjQWFxbatIMlj1b0t-MdYXbMMI",
            appKey: "Mr9om2LVOcnREfrzxluXJYKm",
            placeholder: "欢迎留言…",
            avatar: "retro",
            avatarForce: false,
            meta: ["nick","mail"],
            pageSize: 10,
            lang: "zh-CN",
            visitor: false,
            highlight: true,
            recordIP: false,
            
            
            
            enableQQ: false,
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/gallery/common/profile.jpg" alt="Jiang WU"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Jiang WU</p><p class="is-size-6 is-block">Daddy, Husband, Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Espoo, Finland</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">28</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">16</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">29</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Jenkins-Shared-Libraries"><span class="level-left"><span class="level-item">1</span><span class="level-item">Jenkins Shared Libraries</span></span></a></li><li><a class="level is-mobile" href="#如何使用和扩展-Shared-Libraries"><span class="level-left"><span class="level-item">2</span><span class="level-item">如何使用和扩展 Shared Libraries</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#目录结构"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">目录结构</span></span></a></li><li><a class="level is-mobile" href="#step-方法的写法"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">step 方法的写法</span></span></a></li><li><a class="level is-mobile" href="#使用自己的公共文件"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">使用自己的公共文件</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#classpath-的配置"><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">classpath 的配置</span></span></a></li><li><a class="level is-mobile" href="#调用"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">调用</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#开发框架"><span class="level-left"><span class="level-item">3</span><span class="level-item">开发框架</span></span></a></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">4</span><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-09-28T10:36:05.000Z">2022-09-28</time></p><p class="title"><a href="/2022/09/28/kubernetes/debug_kubelet_dead_oom/">记一次kubelet假死的问题排查</a></p><p class="categories"><a href="/categories/kubernetes/">kubernetes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-09T13:15:42.000Z">2022-05-09</time></p><p class="title"><a href="/2022/05/09/runc/runc-hello-md/">runc 入门使用</a></p><p class="categories"><a href="/categories/runc/">runc</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-05-06T12:14:48.000Z">2022-05-06</time></p><p class="title"><a href="/2022/05/06/go/error/fix-file-is-not-goimports-md/">Golang 解决错误 File is not goimports -ed (goimports)</a></p><p class="categories"><a href="/categories/golang/">golang</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-03-08T19:05:37.000Z">2022-03-08</time></p><p class="title"><a href="/2022/03/08/cicd/jenkins/jenkins-load-groovy-script-md/">jenkins pipeline加载groovy脚本</a></p><p class="categories"><a href="/categories/jenkins/">jenkins</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-03-06T18:16:13.000Z">2022-03-06</time></p><p class="title"><a href="/2022/03/06/go/basic/go-golang-timeout-md/">go中实现简单异步回调函数</a></p><p class="categories"><a href="/categories/golang/">golang</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ansible/"><span class="tag">ansible</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/builder/"><span class="tag">builder</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/centos8/"><span class="tag">centos8</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/channel/"><span class="tag">channel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/error/"><span class="tag">error</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hugo/"><span class="tag">hugo</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/intellij/"><span class="tag">intellij</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jenkins/"><span class="tag">jenkins</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kubernetes/"><span class="tag">kubernetes</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kubernetes%E5%B7%A5%E5%85%B7/"><span class="tag">kubernetes工具</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lsof/"><span class="tag">lsof</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/makefile/"><span class="tag">makefile</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openstack/"><span class="tag">openstack</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openstack%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"><span class="tag">openstack常用操作</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pipeline/"><span class="tag">pipeline</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pointer/"><span class="tag">pointer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/runc/"><span class="tag">runc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring/"><span class="tag">spring</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/thread/"><span class="tag">thread</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tutorial/"><span class="tag">tutorial</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vagrant/"><span class="tag">vagrant</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webflux/"><span class="tag">webflux</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/ansible/"><span class="level-start"><span class="level-item">ansible</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/blog/"><span class="level-start"><span class="level-item">blog</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/golang/"><span class="level-start"><span class="level-item">golang</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/intellij/"><span class="level-start"><span class="level-item">intellij</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/java/"><span class="level-start"><span class="level-item">java</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/java/spring/"><span class="level-start"><span class="level-item">spring</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/java/spring/webflux/"><span class="level-start"><span class="level-item">webflux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/jenkins/"><span class="level-start"><span class="level-item">jenkins</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/kubernetes/"><span class="level-start"><span class="level-item">kubernetes</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/kubernetes/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/openstack/"><span class="level-start"><span class="level-item">openstack</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/runc/"><span class="level-start"><span class="level-item">runc</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vagrant/"><span class="level-start"><span class="level-item">vagrant</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/gallery/common/ava.png" alt="Unprofessional BUG" height="28"></a><p class="is-size-7"><span>&copy; 2022 Jiang WU</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>